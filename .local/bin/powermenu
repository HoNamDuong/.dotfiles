#!/usr/bin/bash

# Message
mesg="Uptime: `uptime -p | sed -e 's/up //g'`"

# Options
if [ -f /usr/bin/rofi ]; then
    shutdown=''
    reboot=''
    lock=''
    suspend=''
    logout=''
    hibernate=""

elif [ -f /usr/bin/dmenu ]; then
    shutdown='Shutdown'
    reboot='Reboot'
    lock='Lock'
    suspend='Suspend'
    logout='Logout'
    hibernate="Hibernate"

else
    exit 0
fi

run_command() {
    if [ -f /usr/bin/rofi ]; then
        # rofi 
        theme="$HOME/.config/rofi/themes/powermenu.rasi"
        list_col='6'
        list_row='1'

        echo -e "$lock\n$logout\n$reboot\n$shutdown\n$suspend\n$hibernate" | \
            rofi \
                -dmenu \
                -mesg "$mesg" \
                -markup-rows \
                -theme-str "listview {columns: $list_col; lines: $list_row;}" \
                -theme "$theme"

    elif [ -f /usr/bin/dmenu ]; then
        # dmenu
        echo -e "$lock\n$logout\n$reboot\n$shutdown\n$suspend\n$hibernate" | \
            dmenu \
                -i \
                -p "$mesg" \
                -fn 'monospace-12' \
                -nf '#c8d3f5' \
                -nb '#1a1b26' \
                -sf '#c8d3f5' \
                -sb '#3b4261'
    else 
        exit 0
    fi
}

# Actions
chosen="$(run_command)"
case ${chosen} in
    $lock)
        if [[ -x '/usr/bin/i3lock' ]]; then
            i3lock --no-unlock-indicator --pointer=default --color "000000"
        fi
        ;;
    $logout)
        if [[ "$DESKTOP_SESSION" == 'i3' ]]; then
            i3-msg exit
        else
            loginctl kill-session ''
        fi
        ;;
    $reboot)
        /usr/bin/systemctl reboot
        ;;
    $shutdown)
        /usr/bin/systemctl poweroff
        ;;
    $suspend)
        /usr/bin/systemctl suspend 
        ;;
    $hibernate)
        /usr/bin/systemctl suspend 
        ;;
esac
