#!/usr/bin/bash

# Message
mesg="Uptime: `uptime -p | sed -e 's/up //g'`"

# Options
if [ -f /usr/bin/rofi ]; then
    shutdown=''
    reboot=''
    lock=''
    suspend=''
    logout=''
    hibernate=""

elif [ -f /usr/bin/dmenu ]; then
    shutdown='Shutdown'
    reboot='Reboot'
    lock='Lock'
    suspend='Suspend'
    logout='Logout'
    hibernate="Hibernate"

else
    exit 0
fi

run_command() {
    if [ -f /usr/bin/rofi ]; then
        theme="$HOME/.config/rofi/themes/powermenu.rasi"
        list_col='6'
        list_row='1'
        echo -e "$lock\n$logout\n$reboot\n$shutdown\n$suspend\n$hibernate" | \
            rofi \
                -dmenu \
                -mesg "$mesg" \
                -markup-rows \
                -theme-str "listview {columns: $list_col; lines: $list_row;}" \
                -theme "$theme"
    elif [ -f /usr/bin/dmenu ]; then
        echo -e "$lock\n$logout\n$reboot\n$shutdown\n$suspend\n$hibernate" | \
            # dmenu \
            #     -i \
            #     -p "$mesg" \
            #     -fn 'monospace-12' \
            #     -nf '#c8d3f5' \
            #     -nb '#1a1b26' \
            #     -sf '#c8d3f5' \
            #     -sb '#3b4261'
            dmenu \
                -i \
                -p "$mesg" \
                -fn 'monospace-12' \
                -nf '#c5c8c6' \
                -nb '#1d1f21' \
                -sf '#c5c8c6' \
                -sb '#373B41'
    else 
        exit 0
    fi
}

# Actions
chosen="$(run_command)"
case ${chosen} in
    $lock)
        loginctl lock-session
        ;;
    $logout)
        loginctl kill-session ''
        ;;
    $reboot)
        /usr/bin/systemctl reboot
        ;;
    $shutdown)
        /usr/bin/systemctl poweroff
        ;;
    $suspend)
        /usr/bin/systemctl suspend 
        ;;
    $hibernate)
        /usr/bin/systemctl hibernate 
        ;;
esac
